{"version":3,"sources":["wsm-favorites.js"],"names":["window","angular","ngWsmFavorites","module","factory","$http","loadFav","data","action","elements","fav","method","url","ajax_path","responseType","success","res","status","headers","config","fav_checked","console","log","i","id","onChangeCallback","length","indexOf","runLoadCallback","warn","error","_factory","this","onLoadCallback","onLoad","callback","push","onChange","t","setFav","in_fav","checked","reload","directive","$ngWsmFavorites","info","scope","favoriteId","favoriteClass","link","$scope","$elm","attrs","ctrl","parseInt","selected","addClass","removeClass","bind","hasClass","total"],"mappings":"CAAA,SAAUA,EAAQC,GAEd,YAEA,IAAIC,GAAiBD,EAAQE,OAAO,kBAAmB,MAEvDD,GAAeE,QAAQ,kBAAmB,SAASC,GAuE/C,QAASC,KAEL,GAAIC,IACAC,OAAU,QACVC,SAAYC,EAGhBL,IACIM,OAAQ,OACRC,IAAKC,EACLC,aAAc,OACdP,KAAMA,IAEVQ,QAAQ,SAAUC,EAAKC,EAAQC,EAASC,GAEpC,GAAIH,EAAID,QAAS,CAEbK,EAAqC,gBAAhBJ,GAAIP,UAAyC,OAAjBO,EAAIP,SAAoBO,EAAIP,YAE7EY,QAAQC,IAAI,gBAAiBF,EAE7B,KAAI,GAAIG,KAAKb,GAAI,CAEb,GAAIc,GAAKd,EAAIa,EACqB,mBAAxBE,GAAiBD,IACvBC,EAAiBD,GAAIJ,EAAYM,OAAS,GAAKN,EAAYO,QAAQH,IAAM,GAGhGI,EAAgBZ,OAGDK,SAAQQ,KAAKb,KAIrBc,MAAM,SAAUvB,EAAMU,EAAQC,EAASC,GACnCE,QAAQS,MAAM,oCAAqCvB,GACnDG,OAtGR,GAAIqB,GAAWC,KACXP,KACAQ,KACAvB,KACAU,KACAP,EAAY,wCAEhBkB,GAASG,OAAS,SAAUC,GAEjC,MAAsB,kBAAZA,QAGVF,GAAeG,KAAKD,IAGfJ,EAASM,SAAW,SAAUb,EAAIW,GAE9B,MAAsB,kBAAZA,KAGVzB,EAAI0B,KAAKZ,GAETC,EAAiBD,GAAMW,OAEpBf,EAAYM,OAAS,GAAKN,EAAYO,QAAQH,IAAM,GACnDC,EAAiBD,IAAI,KAGnC,IAAII,GAAkB,SAASrB,GAC9B,IAAI,GAAI+B,KAAKL,GACZA,EAAeK,GAAG/B,GAmFd,OAhFAwB,GAASQ,OAAS,SAAUf,EAAIgB,GAE5B,GAAIjC,IACAC,OAAU,MACVgB,GAAMA,EAGVnB,IACIM,OAAQ,OACRC,IAAKC,EACLC,aAAc,OACdP,KAAMA,IAEVQ,QAAQ,SAAUC,EAAKC,EAAQC,EAASC,GAEhCH,EAAID,QAE8B,kBAAxBU,GAAiBD,IACvBC,EAAiBD,GAAIR,EAAIyB,SAG7BpB,QAAQQ,KAAKb,KAIrBc,MAAM,SAAUvB,EAAMU,EAAQC,EAASC,GACnCE,QAAQS,MAAM,oCAAqCvB,GACnDG,QA+CRqB,EAASW,OAAS,WACdpC,KAGJA,IAEOyB,IAGX7B,EAAeyC,UAAU,eAAgB,kBAAmB,SAASC,GAIjE,MAFAvB,SAAQwB,KAAK,gCAGTC,OACIC,WAAW,IACXC,cAAc,KAElBC,KAAM,SAASC,EAAQC,EAAMC,EAAOC,GAEhC,MAA+B,gBAArBH,GAAOH,YAA0BO,eAAgBJ,GAAOH,YAAc,MAE5E1B,SAAQQ,KAAK,uBAIiB,mBAAxBqB,GAAOF,eAAwD,IAAxBE,EAAOF,gBACpDE,EAAOF,cAAgB,UAE3BJ,EAAgBP,SAASa,EAAOH,WAAY,SAAUQ,GAElDlC,QAAQC,IAAI,4BAA6BiC,EAAUL,EAAOF,eAEvDO,EACCJ,EAAKK,SAASN,EAAOF,eAErBG,EAAKM,YAAYP,EAAOF,qBAIhCG,GAAKO,KAAK,QAAS,WACfd,EAAgBL,OAAOW,EAAOH,YAAaI,EAAKQ,SAAST,EAAOF,wBAMnF9C,EAAeyC,UAAU,oBAAqB,kBAAmB,SAASC,GAInE,MAFAvB,SAAQwB,KAAK,sCAGTC,SAGAG,KAAM,SAASC,EAAQC,EAAMC,EAAOC,GAEhCT,EAAgBV,OAAO,SAAU0B,GAE7BvC,QAAQC,IAAI,0BAA2BsC,WASxD5D,OAAQA,OAAOC","file":"wsm.favorites.min.js","sourcesContent":["(function(window, angular) {\n\n    'use strict';\n\n    var ngWsmFavorites = angular.module('ngWsmFavorites', ['ng']);\n\n    ngWsmFavorites.factory('$ngWsmFavorites', function($http){\n\n        function inherit(parent, extra) {\n            return angular.extend(Object.create(parent), extra);\n        }\n\n        var _factory = this,\n            onChangeCallback = {},\n            onLoadCallback = [],\n            fav = [],\n            fav_checked = [],\n            ajax_path = '/bitrix/tools/wsm.favorites/action.php';\n\n        _factory.onLoad = function (callback) {\n\t\t\n\t\t\tif(typeof callback != 'function')\n                return false;\n\t\t\t\n\t\t\tonLoadCallback.push(callback);\n\t\t}\n\t\t\n        _factory.onChange = function (id, callback) {\n\n            if(typeof callback != 'function')\n                return false;\n\n            fav.push(id);\n\n            onChangeCallback[id] = callback;\n\n            if(fav_checked.length > 0 && fav_checked.indexOf(id) > -1)\n                onChangeCallback[id](true);\n        }\n\t\t\n\t\tvar runLoadCallback = function(data){\n\t\t\tfor(var t in onLoadCallback)\n\t\t\t\tonLoadCallback[t](data);\n\t\t}\n\n        _factory.setFav = function (id, in_fav) {\n\n            var data = {\n                'action': 'add',\n                'id': id\n            };\n\n            $http({\n                method: 'POST',\n                url: ajax_path,\n                responseType: 'json',\n                data: data,\n            }).\n            success(function (res, status, headers, config) {\n\n                if (res.success) {\n\n                    if(typeof onChangeCallback[id] == 'function')\n                        onChangeCallback[id](res.checked);\n\n                } else {\n                    console.warn(res);\n                }\n\n            }).\n            error(function (data, status, headers, config) {\n                console.error('err =========================== (', data);\n                fav = {};\n            });\n\n        }\n\n        function loadFav() {\n\n            var data = {\n                'action': 'check',\n                'elements': fav\n                };\n\n            $http({\n                method: 'POST',\n                url: ajax_path,\n                responseType: 'json',\n                data: data,\n            }).\n            success(function (res, status, headers, config) {\n\n                if (res.success) {\n\n                    fav_checked = typeof res.elements == 'object' && res.elements !== null ? res.elements : [];\n\n                    console.log('fav_checked: ', fav_checked);\n\n                    for(var i in fav){\n\n                        var id = fav[i];\n                        if(typeof onChangeCallback[id] == 'function')\n                            onChangeCallback[id](fav_checked.length > 0 && fav_checked.indexOf(id) > -1);\n                    }\n\n\t\t\t\t\trunLoadCallback(res);\n\n                } else {\n                    console.warn(res);\n                }\n\n            }).\n            error(function (data, status, headers, config) {\n                console.error('err =========================== (', data);\n                fav = {};\n            });\n\n        }\n\n        _factory.reload = function () {\n            loadFav();\n        }\n\n        loadFav();\n\n        return _factory;\n    });\n\n    ngWsmFavorites.directive('wsmFavorite', ['$ngWsmFavorites', function($ngWsmFavorites) {\n\n        console.info('init directive ... favorite');\n\n        return {\n            scope: {\n                favoriteId:'@',\n                favoriteClass:'@',\n            },\n            link: function($scope, $elm, attrs, ctrl) {\n\n                if(typeof $scope.favoriteId != 'string' || parseInt(typeof $scope.favoriteId) < 1)\n                {\n                    console.warn('not set favoriteId');\n                    return;\n                }\n\n                if(typeof $scope.favoriteClass == 'undefined' || $scope.favoriteClass == '')\n                    $scope.favoriteClass = 'active';\n\n                $ngWsmFavorites.onChange($scope.favoriteId, function (selected) {\n\n                    console.log('onChange fav, selected = ', selected, $scope.favoriteClass);\n\n                    if(selected)\n                        $elm.addClass($scope.favoriteClass);\n                    else\n                        $elm.removeClass($scope.favoriteClass);\n\n                    });\n\n                $elm.bind('click', function () {\n                    $ngWsmFavorites.setFav($scope.favoriteId, !$elm.hasClass($scope.favoriteClass));\n                    });\n            }\n        };\n    }]);\n\n\tngWsmFavorites.directive('wsmFavoriteTotal', ['$ngWsmFavorites', function($ngWsmFavorites) {\n\n        console.info('init directive ... favorite total');\n\n        return {\n            scope: {\n                \n            },\n            link: function($scope, $elm, attrs, ctrl) {\n\n                $ngWsmFavorites.onLoad(function (total) {\n\n                    console.log('onLoad fav, selected = ', total);\n\n                    // TODO set total\n\n                    });\n            }\n        };\n    }]);\n\n})(window, window.angular);"]}